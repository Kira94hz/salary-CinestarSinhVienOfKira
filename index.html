<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Máy Tính Lương</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        table { width: 60%; margin: auto; border-collapse: collapse; }
        th, td { border: 1px solid black; padding: 8px; text-align: center; }
        input { width: 100px; }
        button { margin-top: 10px; padding: 10px; }
    </style>
</head>
<body>
    <h2>Máy Tính Lương Theo Ca Làm</h2>
    <table>
        <thead>
            <tr>
                <th>Ngày</th>
                <th>Giờ Bắt Đầu</th>
                <th>Giờ Kết Thúc</th>
                <th>Lương Ngày (VND)</th>
            </tr>
        </thead>
        <tbody id="salaryTable"></tbody>
    </table>
    <button onclick="addRow()">Thêm Ngày</button>
    <button onclick="calculateSalary()">Tính Lương</button>
    <h3>Tổng Lương: <span id="totalSalary">0</span> VND</h3>

    <script>
        function addRow() {
            const table = document.getElementById("salaryTable");
            const row = table.insertRow();
            const cell1 = row.insertCell(0);
            const cell2 = row.insertCell(1);
            const cell3 = row.insertCell(2);
            const cell4 = row.insertCell(3);
            
            cell1.innerHTML = table.rows.length;
            cell2.innerHTML = '<input type="time" step="900" id="start' + table.rows.length + '" required>';
            cell3.innerHTML = '<input type="time" step="900" id="end' + table.rows.length + '" required>';
            cell4.innerHTML = '0';
        }

        function calculateSalary() {
            let totalSalary = 0;
            const LUONG_GIO = 24000;
            const HE_SO_TANG_CA = 1.3;
            const PHU_CAP_AN = 30000;
            
            const table = document.getElementById("salaryTable");
            for (let i = 0; i < table.rows.length; i++) {
                let start = document.getElementById("start" + (i+1)).value;
                let end = document.getElementById("end" + (i+1)).value;
                
                if (!start || !end) continue;
                
                let [startHour, startMin] = start.split(":").map(Number);
                let [endHour, endMin] = end.split(":").map(Number);
                
                let startTime = (startHour % 24) + startMin / 60;
                let endTime = (endHour % 24) + endMin / 60;
                if (endTime <= startTime) endTime += 24;
                
                let totalHours = endTime - startTime - 0.5; // Trừ 30 phút nghỉ
                let normalHours = 0, extraHours = 0;
                
                for (let h = startTime; h < endTime; h += 0.25) {
                    let hourAdjusted = h % 24;
                    if ((hourAdjusted >= 22 && hourAdjusted < 24) || (hourAdjusted >= 0 && hourAdjusted < 1)) {
                        extraHours += 0.25;
                    } else {
                        normalHours += 0.25;
                    }
                }
                
                let adjustFactor = totalHours / (normalHours + extraHours);
                normalHours *= adjustFactor;
                extraHours *= adjustFactor;
                
                let dailySalary = (normalHours * LUONG_GIO) + (extraHours * LUONG_GIO * HE_SO_TANG_CA) + PHU_CAP_AN;
                table.rows[i].cells[3].innerText = dailySalary.toFixed(2);
                totalSalary += dailySalary;
            }
            document.getElementById("totalSalary").innerText = totalSalary.toFixed(2);
        }
    </script>
</body>
</html>
